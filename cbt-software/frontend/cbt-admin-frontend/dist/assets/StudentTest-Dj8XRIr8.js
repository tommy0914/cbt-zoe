import{r as a,j as e,a as f}from"./index-DoLby0QM.js";function Q({token:l}){var E;const[m,I]=a.useState(""),[w,N]=a.useState([]),[v,D]=a.useState([]),[o,T]=a.useState(""),[p,b]=a.useState(""),[d,y]=a.useState(1),[u,P]=a.useState(10),[_,Y]=a.useState(0),[h,B]=a.useState(0),[c,F]=a.useState(null),[g,A]=a.useState({}),[r,$]=a.useState(null),S=a.useRef(null),[x,z]=a.useState(null);a.useEffect(()=>{if(!c)return;const t=Date.now()+c.durationMinutes*60*1e3;return z(Math.max(0,Math.round((t-Date.now())/1e3))),S.current=setInterval(()=>{const n=Math.max(0,Math.round((t-Date.now())/1e3));z(n),n<=0&&clearInterval(S.current)},1e3),()=>clearInterval(S.current)},[c]),a.useEffect(()=>{async function t(){let s=null;l&&(s=await f.get(`/api/tests/list?page=${d}&pageSize=${u}`,l)),(!s||!s.tests)&&(s=await f.get(`/api/tests/search?page=${d}&pageSize=${u}`)),s.tests&&(N(s.tests),Y(s.total||s.tests.length),y(s.page||d),P(s.pageSize||u),B(s.totalPages||Math.ceil((s.total||s.tests.length)/(s.pageSize||u))),s.tests.length>0&&I(s.tests[0]._id))}t();async function n(){if(l)try{const s=await f.get("/api/classes",l),i=s&&s.classes?s.classes:[];if(i&&Array.isArray(i)&&(D(i),s.length>0)){T(C=>C||i[0]._id);const j=i[0].subjects||[];j.length>0&&b(C=>C||j[0])}}catch{}}n()},[l,d,u]);function R(t){t<1||h&&t>h||y(t)}async function L(t=!1){if(!l)return alert("Login as student first");if(!m)return alert("Select a test");if(!o)return alert("Please select a class before starting the test");if(!p)return alert("Please select a subject before starting the test");const n=`?classId=${encodeURIComponent(o)}&subject=${encodeURIComponent(p)}&isPractice=${t}`,s=await f.get(`/api/tests/start/${m}${n}`,l);s.attemptId?(F({...s,isPractice:t}),A({}),$(null)):alert(s.message||"Failed to start test")}function U(t,n){A(s=>({...s,[t]:n}))}async function M(){if(!c)return;const t={attemptId:c.attemptId,answers:Object.keys(g).map(s=>({questionId:s,selectedAnswer:g[s]}))},n=await f.post("/api/tests/submit",t,l);$(n)}return a.useEffect(()=>{x===0&&c&&!r&&M()},[x]),a.useEffect(()=>{const t=()=>{document.hidden&&alert("Warning: You have switched to another tab. This action may be flagged.")};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}},[]),e.jsxs("div",{onCopy:t=>t.preventDefault(),onPaste:t=>t.preventDefault(),children:[e.jsx("h3",{children:"ðŸ“‹ Assessment Portal"}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{children:"Select Your Assessment"}),l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Class"}),e.jsxs("select",{value:o,onChange:t=>{const n=t.target.value;T(n);const s=v.find(j=>j._id===n),i=s&&s.subjects||[];b(i.length>0?i[0]:"")},children:[e.jsx("option",{value:"",children:"-- choose class --"}),v.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Subject"}),e.jsxs("select",{value:p,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"",children:"-- all subjects --"}),(((E=v.find(t=>t._id===o))==null?void 0:E.subjects)||[]).map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{children:"Test"}),e.jsxs("select",{value:m,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"",children:"-- pick a test --"}),w.map(t=>e.jsxs("option",{value:t._id,children:[t.testName," â€” ",t.durationMinutes," mins"]},t._id))]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[e.jsx("button",{onClick:()=>L(!1),disabled:!(l&&o&&p),style:{flex:1},children:"Start Test"}),e.jsx("button",{onClick:()=>L(!0),disabled:!(l&&o&&p),style:{flex:1,background:"var(--ye-accent)"},children:"Practice Mode"})]}),!(l&&o&&p)&&e.jsx("div",{style:{color:"#ef4444",background:"#fee2e2",padding:"12px",borderRadius:"8px",fontSize:"13px"},children:"âš ï¸ You must select a class and subject to start."})]}):e.jsx("div",{style:{color:"#64748b",background:"var(--ye-light-bg)",padding:"16px",borderRadius:"8px"},children:"Login to access your assessments."})]}),e.jsxs("div",{className:"card",style:{marginTop:"16px"},children:[e.jsx("h4",{children:"Available Assessments"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"13px",color:"#64748b"},children:_?`${_} assessments available`:""}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("button",{onClick:()=>R(d-1),disabled:d<=1,style:{padding:"6px 10px",fontSize:"12px"},children:"â† Prev"}),e.jsxs("span",{style:{fontSize:"13px"},children:["Page ",d,h?` / ${h}`:""]}),e.jsx("button",{onClick:()=>R(d+1),disabled:h?d>=h:w.length<u,style:{padding:"6px 10px",fontSize:"12px"},children:"Next â†’"}),e.jsxs("select",{value:u,onChange:t=>{P(parseInt(t.target.value)),y(1)},style:{padding:"6px",fontSize:"12px"},children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]})]})]})]}),c&&e.jsxs("div",{children:[e.jsxs("h4",{children:["Attempt: ",c.attemptId]}),e.jsxs("div",{children:["Time left: ",x!=null?`${Math.floor(x/60)}:${("0"+x%60).slice(-2)}`:"â€”"]}),e.jsx("div",{children:c.questions.map(t=>{var n,s;return e.jsxs("div",{className:"question card",children:[e.jsx("div",{children:e.jsx("strong",{children:t.questionText})}),e.jsx("div",{className:"options",children:t.options.map(i=>e.jsx("button",{onClick:()=>U(t._id,i),style:{background:g[t._id]===i?"#eef":"#fff"},children:i},i))}),r&&r.detailedResults&&e.jsx("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid #eee"},children:e.jsxs("p",{style:{color:(n=r.detailedResults.find(i=>i.questionId===t._id))!=null&&n.isCorrect?"green":"red"},children:["Your answer: ",g[t._id]," | Correct answer: ",(s=r.detailedResults.find(i=>i.questionId===t._id))==null?void 0:s.correctAnswer]})})]},t._id)})}),!r&&e.jsx("button",{onClick:M,children:"Submit Answers"})]}),r&&!c.isPractice&&e.jsxs("div",{className:"card",children:[e.jsx("h4",{children:"Result"}),e.jsxs("div",{children:["Score: ",r.score," / ",r.total," (",Math.round(r.percentage),"%)"]}),e.jsxs("div",{children:["Passed: ",r.isPassed?"Yes":"No"]})]})]})}export{Q as default};
